<xsl:stylesheet version="2.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" exclude-result-prefixes="#default,#all">

  <xsl:template match="/">
    <docroot xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <actionLink>
        <xsl:value-of select ="ItpDocumentRequest/UrlLinks/*[LinkType='ActionLink']/LinkUrl"/>
      </actionLink>
      <Request>
        <AppUrl>
          <xsl:value-of select = "ItpDocumentRequest/AppUrl"/>
        </AppUrl>
        <xsl:copy-of select = "ItpDocumentRequest/Property"/>
        <Tenancy>
          <xsl:apply-templates select = "ItpDocumentRequest/Tenancy/*"/>
        </Tenancy>
        <xsl:copy-of select = "ItpDocumentRequest/EMailUser"/>
        <xsl:copy-of select = "ItpDocumentRequest/SubjectDocument"/>
        <PropertyUsers list="true">
          <xsl:for-each select = "ItpDocumentRequest/PropertyUsers/*">
            <xsl:copy-of select = "."/>
          </xsl:for-each>
        </PropertyUsers>
        <PropertyAdverts list="true">
          <xsl:for-each select = "ItpDocumentRequest/Property/PropertyAdverts/*">
            <xsl:copy-of select = "."/>
          </xsl:for-each>
        </PropertyAdverts>
        <UrlLinks list="true">
          <xsl:for-each select = "ItpDocumentRequest/UrlLinks/*">
            <xsl:copy-of select = "."/>
          </xsl:for-each>
        </UrlLinks>
        <Tenants list="true">
          <xsl:for-each select ="ItpDocumentRequest/PropertyUsers/*[PropertyUserType/Value='ManuallyInvitedTenant']">
            <xsl:copy-of select = "."/>
          </xsl:for-each>
          <xsl:for-each select ="ItpDocumentRequest/PropertyUsers/*[PropertyUserType/Value='AdditionalTenant']">
            <xsl:copy-of select = "."/>
          </xsl:for-each>
        </Tenants>
        <PurchaseInfo>
          <xsl:copy-of select = "ItpDocumentRequest/PurchaseInfo/*"/>
          <Items list="true">
            <xsl:for-each select = "ItpDocumentRequest/PurchaseInfo/PaymentItems/*">
              <xsl:copy-of select = "."/>
            </xsl:for-each>
          </Items>
        </PurchaseInfo>

        <UsersRegisteringDeposit>
          <xsl:for-each select ="ItpDocumentRequest/PropertyUsers/*[IsRegisteringDeposit='true']/*">
            <xsl:copy-of select = "."/>
          </xsl:for-each>
        </UsersRegisteringDeposit>
        <Landlords list="true">
          <xsl:for-each select ="ItpDocumentRequest/PropertyUsers/*[PropertyUserType/Value='PropertyOwner']">
            <xsl:copy-of select = "."/>
          </xsl:for-each>
          <xsl:for-each select ="ItpDocumentRequest/PropertyUsers/*[PropertyUserType/Value='AdditionalLandlord']">
            <xsl:copy-of select = "."/>
          </xsl:for-each>
        </Landlords>
        <Guarantors list="true">
          <xsl:for-each select ="ItpDocumentRequest/PropertyUsers/*[PropertyUserType/Value='Guarantor']">
            <xsl:copy-of select = "."/>
          </xsl:for-each>
        </Guarantors>
        <Parties list="true">
          <xsl:for-each select ="ItpDocumentRequest/PropertyUsers/*[PropertyUserType/Value='PropertyOwner' and AgencyStaff = 'false']">
            <xsl:copy-of select = "."/>
          </xsl:for-each>
          <xsl:for-each select ="ItpDocumentRequest/PropertyUsers/*[PropertyUserType/Value='AdditionalLandlord']">
            <xsl:copy-of select = "."/>
          </xsl:for-each>
          <xsl:for-each select ="ItpDocumentRequest/PropertyUsers/*[PropertyUserType/Value='ManuallyInvitedTenant']">
            <xsl:copy-of select = "."/>
          </xsl:for-each>
          <xsl:for-each select ="ItpDocumentRequest/PropertyUsers/*[PropertyUserType/Value='AdditionalTenant']">
            <xsl:copy-of select = "."/>
          </xsl:for-each>
          <xsl:for-each select ="ItpDocumentRequest/PropertyUsers/*[PropertyUserType/Value='Guarantor']">
            <xsl:copy-of select = "."/>
          </xsl:for-each>
        </Parties>
        <AgentSignatory>
          <xsl:for-each select ="ItpDocumentRequest/PropertyUsers/*[PropertyUserType/Value='PropertyOwner' and AgencyStaff='true' and SigningUser='true']">
            <xsl:copy-of select = "."/>
          </xsl:for-each>
        </AgentSignatory>
        <SpecialClauses list="true">
	        <xsl:for-each select ="ItpDocumentRequest/Tenancy/OtherTerms/*">
		        <xsl:copy-of select = "."/>
	        </xsl:for-each>
        </SpecialClauses>
      </Request>
      <SystemParameter>
        <xsl:copy-of select = "ItpDocumentRequest/ControllingOrganisation"/>
        <CompanyName>
          <xsl:value-of select ="ItpDocumentRequest/ControllingOrganisation/TradingName"/>
        </CompanyName>
        <CompanyTelephone>
          <xsl:value-of select ="ItpDocumentRequest/ControllingOrganisation/CompanyTelephone"/>
        </CompanyTelephone>
        <CompanyEmail>
          <xsl:value-of select ="ItpDocumentRequest/ControllingOrganisation/CompanyEmail"/>
        </CompanyEmail>
      </SystemParameter>
      <Roles list ="true">
        <Role>
          <Called>Landlord</Called>
          <Values list = "true">
            <V>
              <Value>PropertyOwner</Value>
            </V>
            <V>
              <Value>AdditionalLandlord</Value>
            </V>
          </Values>
        </Role>
        <Role>
          <Called>Tenant</Called>
          <Values list = "true">
            <V>
              <Value>ManuallyInvitedTenant</Value>
            </V>
            <V>
              <Value>AdditionalTenant</Value>
            </V>
          </Values>
        </Role>
        <Role>
          <Called>Guarantor</Called>
          <Values list = "true">
            <V>
              <Value>Guarantor</Value>
            </V>
          </Values>
        </Role>
      </Roles>
    </docroot>
    <xsl:copy-of select="/"/>
  </xsl:template>
  <xsl:template match="Tenancy/TenancyDocuments">
    <TenancyDocuments list="true">
      <xsl:copy-of select = "./*"/>
    </TenancyDocuments>
  </xsl:template>
  <xsl:template match="Tenancy/*">
    <xsl:copy-of select = "."/>
  </xsl:template>
</xsl:stylesheet>